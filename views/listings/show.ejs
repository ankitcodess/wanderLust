<% layout ("./layouts/boilerplate.ejs") %>
<body>
  <div class="container mt-2">

    <h2 class="text-center mb-2"><%= data.title %></h2>

    <div class="card mx-auto show-card listing-card">
      <img src="<%= data.image %>" class="card-img-top show-img" alt="Listing Image">
      <div class="card-body">
      
        <p class="card-text ps-2">
          <i> owned by -<%= data.owner.username %></i> <br><br>
         <%= data.description %> <br>
         â‚¹<%= data.price.toLocaleString("en-IN") %> <br>
         <%= data.location %><br>
          <%= data.country %>
        </p>
       
      </div>
    </div>

  <!-- buttons --> 
    <% if(currUser && currUser._id.equals(data.owner._id)) { %> <!--  so that only owner can edit and delete -->
    <div class="text-center mt-4">
      <a href="/listings/<%= data._id %>/edit" class="btn btn-dark me-3">Edit</a>

      <form method="post" action="/listings/<%= data._id %>?_method=DELETE" style="display:inline;">
        <button class="btn btn-danger">Delete</button>
      </form>
    </div>
    <% } %>  

    <hr>
    <!-- review form  -->
    <div class="col-8 offset-2">
      <% if(currUser) {%>
      <h4>Leave a Review</h4>
      <form method="post" action="/listings/<%= data._id%>/reviews"  class="needs-validation"  novalidate>
        <div class="mb-3 mt-3">
          <!-- <label for="rating" class="form-label">Rating
            <input type="range" min="1" max="5" id="rating" name ="rating" class=""></input>
          </label> -->

          <!-- got from starability -->
          <fieldset class="starability-slot">
  <legend>First rating:</legend>
  <input type="radio" id="no-rate" class="input-no-rate" name="rating" value="1" checked aria-label="No rating." />
  <input type="radio" id="first-rate1" name="rating" value="1" />
  <label for="first-rate1" title="Terrible">1 star</label>
  <input type="radio" id="first-rate2" name="rating" value="2" />
  <label for="first-rate2" title="Not good">2 stars</label>
  <input type="radio" id="first-rate3" name="rating" value="3" />
  <label for="first-rate3" title="Average">3 stars</label>
  <input type="radio" id="first-rate4" name="rating" value="4" />
  <label for="first-rate4" title="Very good">4 stars</label>
  <input type="radio" id="first-rate5" name="rating" value="5" />
  <label for="first-rate5" title="Amazing">5 stars</label>
</fieldset>



        </div>
        <div class="mb-3 mt-3">
          <label for=" comment" class="form-label">Comments</label>
          <textarea name="comment" col="30" rows="5" id="comment" class="form-control" required></textarea>
          <div class="invalid-feedback">please enter a comment </div>
        </div>
        <button class="btn btn-outline-dark">Submit</button>
      </form>
      <% } %>
      <hr>
       <h4>All Reviews</h4>
    <div class="row">
     <% for(review of data.reviews) { %>
       <div class="card col-5 ms-3 mb-3 ">
        <div class="card-body">
    <h5 class="card-title">@<%=review.author.username%></h5>
    <p class="starability-result card-text" data-rating="<%= review.rating %>"></p>  <!--starability-->
    <!-- <p class="card-text"><%= review.rating %> stars</p> -->
     
        <p class="card-text"><%= review.comment %></p>
          <form class="mb-3" method="POST" action="/listings/<%=data._id%>/reviews/<%=review._id%>?_method=DELETE">
            <button class="btn btn-sm btn-dark">Delete</button>
          </form>
          </div>
      </div>
     <% } %> 
     </div>
    

    </div>
   

  </div>
</body>

<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f8f9fa;
  }

  .show-card {
    width: 50%;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    transition: transform 0.2s ease;
  }

  .show-card:hover {
    transform: translateY(-4px);
  }

  .show-img {
    height: 320px;
    object-fit: cover;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
  }

  .card-body {
    padding: 20px;
  }

  .btn {
    width: 100px;
  }

  @media (max-width: 768px) {
    .show-card {
      width: 90%;
    }

    .btn {
      width: auto;
    }
  }
</style>
